function Pong(a){function b(a){F=a}function c(a){E=a}function d(a){u=r/2,z=u,v=10,w=75,G.velocityY=0,a()}function e(){t=H.getContext("2d"),r=H.width,s=H.height,n=150,o=150+3*L,p=2,q=4,y=10,E=!1,F=!1,A=new Score,B=new GameState,C=new TimeCounter,C.initialize(I,J),T()}function f(){$("#timer").html("1:00"),$("#notify").html(""),A.setHomeScore(0),A.setAwayScore(0),S($("#scoreHome"),$("#scoreAway"),A.getHomeScore(),A.getAwayScore());var a=0,a=setInterval(function(){0>=K?(K=3,$("#notify").html("")):(K-=1,$("#notify").html("  "+K+"  "))},1e3);setTimeout(function(){clearInterval(a),$("#notify").html(""),U(),g()},3e3)}function g(){x=0,d(function(){clearInterval(x),x=setInterval(m,G.gameSpeed),clearInterval(D),D=setInterval(function(){R($("#timer"),$("#notify"),C)},1e3)})}function h(a,b,c){t.beginPath(),t.arc(a,b,c,0,2*Math.PI,!0),t.closePath(),1===M?(t.drawImage(N,a-c,b-c,2*c,2*c),M=2):(t.drawImage(O,a-c,b-c,2*c,2*c),M=1)}function i(a,b,c,d){t.beginPath(),t.rect(a,b-L+d/2,c,d),t.closePath(),t.drawImage(P,a,b-L+d/2,c,d+L-d/2)}function j(a,b,c,d){t.beginPath(),t.rect(a,b+L-5,c,d),t.closePath(),t.drawImage(Q,a,b,c,d+L-d/2)}function k(){t.clearRect(0,0,r,s)}function l(){var a=Math.random();if(a>=.37)if(n>z+w)r>=z+w+5&&(z+=5);else if(z>n)z-5>=0&&(z-=5);else{var b=Math.random();b>.3&&(Math.abs(n-z)<Math.abs(n-z-w)?z-5>=0&&(z-=5):r>=z+w+5&&(z+=5))}}function m(){k(),h(n,o,y),E?u+=5:F&&(u-=5),u+=G.velocityY*G.sensitivity,u=Math.min(r-w,u),u=Math.max(0,u),l(),i(u,s-v,w,v),j(z,0,w,v),(n+p+y>r||0>n+p-y)&&(p=-p),0>=o+q-y-L?z>=n||n>=z+w?(A.setHomeScore(A.getHomeScore()+1),S($("#scoreHome"),$("#scoreAway"),A.getHomeScore(),A.getAwayScore()),n=150,o=150+3*L,p=2,q=4):q=-q:o+q+2*y+L-v>s&&(n>u&&u+w>n?(p=8*((n-(u+w/2))/w),q=-q):(A.setAwayScore(A.getAwayScore()+1),S($("#scoreHome"),$("#scoreAway"),A.getHomeScore(),A.getAwayScore()),n=150,o=150+3*L,p=2,q=-4)),C.isTimeOver()&&(0===C.getMinute()&&0===C.getSecond()&&($("#notify").html(A.getHomeScore()>A.getAwayScore()?"Voitit":A.getHomeScore()<A.getAwayScore()?"HÃ¤visit":"Tasapeli"),a.emit("screen:gameOver",{homescore:A.getHomeScore(),awayscore:A.getAwayScore()})),clearInterval(x),clearInterval(D),V(),e()),n+=p,o+=q}var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=!1,F=!1,G={velocityY:0,sensitivity:.05,gameSpeed:14},H=document.getElementById("pongCanvas"),I=1,J=0,K=3,L=48,M=1,N=new Image;N.onload=e,N.src="/presentations/pong/screen/images/ball1.png";var O=new Image;O.onload=e,O.src="/presentations/pong/screen/images/ball2.png";var P=new Image;P.onload=e,P.src="/presentations/pong/screen/images/playerHome.png";var Q=new Image;Q.onload=e,Q.src="/presentations/pong/screen/images/playerAway.png";var R=function(a,b,c){var d=c.updateTime(1e3);a.html(d)},S=function(a,b,c,d){a.html(c),b.html(d)},T=function(){B.setCode(B.WAIT),B.setDescription("wait")},U=function(){B.setCode(B.IN_GAME),B.setDescription("in game")},V=function(){B.setCode(B.END_GAME),B.setDescription("end game")};return{initGame:e,startGame:f,setLeftDown:b,setRightDown:c,getGameController:function(){return G}}}var TimeCounter=function(){this.milisecond=0,this.second=0,this.minute=0};TimeCounter.prototype.updateTime=function(a){return this.milisecond=this.milisecond+a,this.milisecond>=1e3&&(this.second--,this.milisecond=0,this.second<=0&&(this.minute--,this.minute<0?(this.minute=0,this.second=0):this.second=59)),this.minute+":"+this.second},TimeCounter.prototype.isTimeOver=function(){return 0==this.minute&&0==this.second?!0:!1},TimeCounter.prototype.initialize=function(a,b){this.minute=a,this.second=b},TimeCounter.prototype.getMinute=function(){return this.minute},TimeCounter.prototype.getSecond=function(){return this.second};var Score=function(){this.homeScore=0,this.awayScore=0};Score.prototype.show=function(a){a.html(this.getScore())},Score.prototype.setHomeScore=function(a){this.homeScore=a},Score.prototype.getHomeScore=function(){return this.homeScore},Score.prototype.setAwayScore=function(a){this.awayScore=a},Score.prototype.getAwayScore=function(){return this.awayScore},Score.prototype.getScore=function(){return this.homeScore+" - "+this.awayScore};var GameState=function(){this.WAIT="WAIT",this.IN_GAME="IN_GAME",this.END_GAME="END_GAME",this.code="",this.description=""};GameState.prototype.setCode=function(a){this.code=a},GameState.prototype.getCode=function(){return this.code},GameState.prototype.setDescription=function(a){this.description=a},GameState.prototype.getDescription=function(){return this.description};